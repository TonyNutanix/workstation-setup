---
- name: Nutanix clusters info
  hosts: localhost
  gather_facts: false

  collections:
    - nutanix.ncp

  vars:
    pc_ip: "10.42.42.40"            # <-- set yours
    nutanix_user: "admin"         # <-- set yours
    nutanix_password: "nx2Tech254!"    # <-- set yours

  module_defaults:
    group/nutanix.ncp.ntnx:
      nutanix_host: "{{ pc_ip }}"
      nutanix_username: "{{ nutanix_user }}"
      nutanix_password: "{{ nutanix_password }}"
      validate_certs: false

  tasks:
    - name: Retreive Cluster Information
      ntnx_clusters_info_v2:
      register: cluster_info

    - name: Verify Connection
      debug:
        msg: "Connection Successful. Found Clusters: {{ cluster_info.response | map(attribute='name') | list }}"